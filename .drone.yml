kind: pipeline
name: deploy

steps:
  - name: Install dependencies
    image: alpine:3.13
    commands:
      - mkdir bin
      - export PATH=${'$'}PATH:${'$'}PWD/bin

      - curl --silent -O %artifactory_url%/terraform-generic-remote/%terraform_version%/terraform_%terraform_version%_linux_amd64.zip
      - unzip terraform_%terraform_version%_linux_amd64.zip
      - chmod +x terraform
      - mv terraform bin/

      - curl --silent -L -O %artifactory_url%/terragrunt-generic-remote/v%terragrunt_version%/terragrunt_linux_amd64
      - chmod +x terragrunt_linux_amd64
      - mv terragrunt_linux_amd64 bin/terragrunt

      - terraform --version
      - terragrunt --version
    when:
      branch: master
      event: push
